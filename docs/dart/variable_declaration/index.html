<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.85.0"><meta name=description content="Simple notes for software engineering"><meta name=author content="mtakamur"><link rel=icon href=https://mtakamur.github.io/images/favicon.png type=image/png><title>変数の宣言 - Pi fruit</title><link href=https://mtakamur.github.io/css/nucleus.css?1660402441 rel=stylesheet><link href=https://mtakamur.github.io/css/fontawesome-all.min.css?1660402441 rel=stylesheet><link href=https://mtakamur.github.io/css/hybrid.css?1660402441 rel=stylesheet><link href=https://mtakamur.github.io/css/featherlight.min.css?1660402441 rel=stylesheet><link href=https://mtakamur.github.io/css/perfect-scrollbar.min.css?1660402441 rel=stylesheet><link href=https://mtakamur.github.io/css/auto-complete.css?1660402441 rel=stylesheet><link href=https://mtakamur.github.io/css/atom-one-dark-reasonable.css?1660402441 rel=stylesheet><link href=https://mtakamur.github.io/css/theme.css?1660402441 rel=stylesheet><link href=https://mtakamur.github.io/css/tabs.css?1660402441 rel=stylesheet><link href=https://mtakamur.github.io/css/hugo-theme.css?1660402441 rel=stylesheet><link href=https://mtakamur.github.io/css/theme-blue.css?1660402441 rel=stylesheet><script src=https://mtakamur.github.io/js/jquery-3.3.1.min.js?1660402441></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=https://mtakamur.github.io/dart/variable_declaration/><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=https://mtakamur.github.io/><img src=https://mtakamur.github.io/images/logo-gray.svg><br>Pi Fruit</a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=https://mtakamur.github.io/js/lunr.min.js?1660402441></script><script type=text/javascript src=https://mtakamur.github.io/js/auto-complete.js?1660402441></script><script type=text/javascript>var baseurl="https://mtakamur.github.io/"</script><script type=text/javascript src=https://mtakamur.github.io/js/search.js?1660402441></script></div><section id=homelinks><ul><li><a class=padding href=https://mtakamur.github.io/><i class="fas fa-home"></i> Home</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/dart/ title=Dart class="dd-item
parent"><a href=https://mtakamur.github.io/dart/>Dart</a><ul><li data-nav-id=/dart/setup_environment/ title=Dart開発環境のセットアップ class=dd-item><a href=https://mtakamur.github.io/dart/setup_environment/>Dart開発環境のセットアップ</a></li><li data-nav-id=/dart/basis_on_function/ title=関数の基礎 class=dd-item><a href=https://mtakamur.github.io/dart/basis_on_function/>関数の基礎</a></li><li data-nav-id=/dart/variable_declaration/ title=変数の宣言 class="dd-item active"><a href=https://mtakamur.github.io/dart/variable_declaration/>変数の宣言</a></li><li data-nav-id=/dart/collection/ title=コレクション class=dd-item><a href=https://mtakamur.github.io/dart/collection/>コレクション</a></li><li data-nav-id=/dart/function-advanced/ title=関数 class=dd-item><a href=https://mtakamur.github.io/dart/function-advanced/>関数</a></li></ul></li><li data-nav-id=/flutter/ title=Flutter class=dd-item><a href=https://mtakamur.github.io/flutter/>Flutter</a><ul><li data-nav-id=/flutter/setup_flutter_sdk/ title="Flutter SDKのセットアップ" class=dd-item><a href=https://mtakamur.github.io/flutter/setup_flutter_sdk/>Flutter SDKのセットアップ</a></li></ul></li><li data-nav-id=/kotlin/ title=Kotlin class=dd-item><a href=https://mtakamur.github.io/kotlin/>Kotlin</a><ul><li data-nav-id=/kotlin/struggled/ title=ハマったこと class=dd-item><a href=https://mtakamur.github.io/kotlin/struggled/>ハマったこと</a><ul><li data-nav-id=/kotlin/struggled/collection_deep_copy/ title="コレクションの deep copy が欲しい" class=dd-item><a href=https://mtakamur.github.io/kotlin/struggled/collection_deep_copy/>コレクションの deep copy が欲しい</a></li><li data-nav-id=/kotlin/struggled/target_of_copy/ title="data class copy() の対象" class=dd-item><a href=https://mtakamur.github.io/kotlin/struggled/target_of_copy/>data class copy() の対象</a></li></ul></li><li data-nav-id=/kotlin/others/ title=その他 class=dd-item><a href=https://mtakamur.github.io/kotlin/others/>その他</a><ul><li data-nav-id=/kotlin/others/trailing_commas/ title="Trailing commas" class=dd-item><a href=https://mtakamur.github.io/kotlin/others/trailing_commas/>Trailing commas</a></li></ul></li></ul></li><li data-nav-id=/effective_kotlin/ title="忙しい人のための Effective Kotlin" class=dd-item><a href=https://mtakamur.github.io/effective_kotlin/>忙しい人のための Effective Kotlin</a><ul><li data-nav-id=/effective_kotlin/part_1/ title="Part 1: Good code(良いコードとは?)" class=dd-item><a href=https://mtakamur.github.io/effective_kotlin/part_1/>Part 1: Good code</a><ul><li data-nav-id=/effective_kotlin/part_1/chapter_1/ title="Chapter 1: Safety(安全なコード)" class=dd-item><a href=https://mtakamur.github.io/effective_kotlin/part_1/chapter_1/>Chapter 1: Safety</a><ul><li data-nav-id=/effective_kotlin/part_1/chapter_1/item_1_limit_mutability/ title="Item 1: Limit mutability(やたらと変更可能にしない)" class=dd-item><a href=https://mtakamur.github.io/effective_kotlin/part_1/chapter_1/item_1_limit_mutability/>Item 1: Limit mutability(やたらと変更可能にしない)</a></li><li data-nav-id=/effective_kotlin/part_1/chapter_1/item_2_minimize_the_scope_of_variables/ title="Item 2: Minimize the scope of variables(変数のスコープは最小化する)" class=dd-item><a href=https://mtakamur.github.io/effective_kotlin/part_1/chapter_1/item_2_minimize_the_scope_of_variables/>Item 2: Minimize the scope of variables(変数のスコープは最小化する)</a></li></ul></li><li data-nav-id=/effective_kotlin/part_1/chapter_2/ title="Chapter 2: Readability(読みやすいコード)" class=dd-item><a href=https://mtakamur.github.io/effective_kotlin/part_1/chapter_2/>Chapter 2: Readability</a></li></ul></li><li data-nav-id=/effective_kotlin/part_2/ title="Part 2: Code design(コード設計)" class=dd-item><a href=https://mtakamur.github.io/effective_kotlin/part_2/>Part 2: Code design</a><ul><li data-nav-id=/effective_kotlin/part_2/chapter_3/ title="Chapter 3: Reusability(再利用性)" class=dd-item><a href=https://mtakamur.github.io/effective_kotlin/part_2/chapter_3/>Chapter 3: Reusability</a><ul><li data-nav-id=/effective_kotlin/part_2/chapter_3/item_19_do_not_repeat_knowledge/ title="Item 19: do not repeat knowledge" class=dd-item><a href=https://mtakamur.github.io/effective_kotlin/part_2/chapter_3/item_19_do_not_repeat_knowledge/>Item 19: do not repeat knowledge</a></li></ul></li><li data-nav-id=/effective_kotlin/part_2/chapter_4/ title="Chapter 4: Abstraction design(抽象化設計)" class=dd-item><a href=https://mtakamur.github.io/effective_kotlin/part_2/chapter_4/>Chapter 4: Abstraction design</a></li><li data-nav-id=/effective_kotlin/part_2/chapter_5/ title="Chapter 5: Object creation(インスタンス生成)" class=dd-item><a href=https://mtakamur.github.io/effective_kotlin/part_2/chapter_5/>Chapter 5: Object creation</a></li><li data-nav-id=/effective_kotlin/part_2/chapter_6/ title="Chapter 6: Class design(クラス設計)" class=dd-item><a href=https://mtakamur.github.io/effective_kotlin/part_2/chapter_6/>Chapter 6: Class design</a></li></ul></li><li data-nav-id=/effective_kotlin/part_3/ title="Part 3: Efficiency(効率の良いコード)" class=dd-item><a href=https://mtakamur.github.io/effective_kotlin/part_3/>Part 3: Efficiency</a><ul><li data-nav-id=/effective_kotlin/part_3/chapter_7/ title="Make it cheap" class=dd-item><a href=https://mtakamur.github.io/effective_kotlin/part_3/chapter_7/>Chapter 7 Make it cheap</a></li><li data-nav-id=/effective_kotlin/part_3/chapter_8/ title="Efficient collection processing" class=dd-item><a href=https://mtakamur.github.io/effective_kotlin/part_3/chapter_8/>Chapter 8: Efficient collection processing</a></li></ul></li></ul></li></ul><section id=footer><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a> from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=https://mtakamur.github.io/>Pi fruit</a> > <a href=https://mtakamur.github.io/dart/>Dart</a> > 変数の宣言</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#変数の宣言>変数の宣言</a></li><li><a href=#変数の型推論>変数の型推論</a></li><li><a href=#変数の初期化と-null-safety>変数の初期化と null safety</a></li><li><a href=#遅延初期化>遅延初期化</a></li><li><a href=#final-定数と-const-定数>final 定数と const 定数</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>変数の宣言</h1><p>整数や文字列などの情報を保持しておくための箱「変数」。
ここでは Dart 言語における変数の宣言方法について学びます。</p><h3 id=変数の宣言>変数の宣言</h3><p>基本的な変数の宣言は下記のように行います。
下記は文字列を格納するための<code>String</code>型の変数を<code>message</code>という名前で宣言し、その変数の中身を &ldquo;Hello World!&rdquo; にする書き方です。
変数の宣言の仕方はシンプルで、「変数の型 + 変数の名前 + その中身」によって行えます。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dart data-lang=Dart><span style=color:#66d9ef>String</span> message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Hello World!&#34;</span>; <span style=color:#75715e>// (1)
</span></code></pre></div><p>当然、変数<code>message</code>は文字列を格納するための変数ですので、下記のように無理に整数を代入しようとするとエラーになります。
変数の型は、代入しようとしている値の型に応じて適切なものを選択する必要があります。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dart data-lang=Dart><span style=color:#66d9ef>String</span> message <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>; <span style=color:#75715e>// 型の不整合によるエラー
</span></code></pre></div><h3 id=変数の型推論>変数の型推論</h3><p>ところで(1)の変数宣言では、= の右辺を見れば、変数は明らかに String 型ですので、宣言の先頭でわざわざ String 型を宣言するのは無駄があるように思います。
そこで型推論の登場です。
Dart では<code>var</code>として変数定義することで、値から型を推測して適当な型をあてはめてくれます。
例えば(1)と等価な宣言として、以下のような記述が可能です。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dart data-lang=Dart><span style=color:#66d9ef>var</span> message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Hello World!&#34;</span>; <span style=color:#75715e>// (2)
</span></code></pre></div><p>関数の戻り値の型を省略すると動的(dynamic)な戻り値として扱われるのに対して、<code>var</code>による変数定義では型を推論して静的(static)に決定します。
従って、(2)によって決められる型は Object 型ではなく、まぎれもなく String 型であることには注意してください。</p><p>dynamic な変数が必要な場合には以下の方法で宣言することができます。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dart data-lang=Dart><span style=color:#66d9ef>Object</span> message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Hello World!;</span>
</code></pre></div><p>もしくは</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dart data-lang=Dart><span style=color:#66d9ef>dynamic</span> message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Hello World!&#34;</span>;
</code></pre></div><h3 id=変数の初期化と-null-safety>変数の初期化と null safety</h3><p>突然ですが、下記の宣言による変数には何が代入されているでしょうか?</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dart data-lang=Dart><span style=color:#66d9ef>int</span> number; <span style=color:#75715e>// (3)
</span></code></pre></div><p>答えは開発環境で null safety が有効かどうかによって異なります。
null safety が有効な場合には、(3)の定義は文法違反でそもそもエラーとなります。
一方、null safety が無効な場合には <code>number</code> は null になります。
null safety が有効かどうかは利用している Dart SDK のバージョンによって異なります。
Dart 2.12 よりも新しバージョンの Dart SDK を利用している場合には null safety が有効になっています(dart-sdk のディレクトリ内にある<code>version</code>というファイルに Dart SDK のバージョンが記載されています)。</p><p>null safety が有効な場合、いかなる変数も null になることが基本的にできません。
null 状態を許容しないことにより、ランタイムでの null pointer exception を回避するようになっています。
そのため、null safety が有効な場合には変数の宣言と同時に特定の値で初期化する必要があります。
例えば、int 型変数の初期化では以下のようにすると、あらかじめ 0 が代入された(0 で初期化された)変数を宣言することができます。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dart data-lang=Dart><span style=color:#66d9ef>int</span> number <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</code></pre></div><p>null safety が有効な場合に null が必要な場合には、その変数が null になれること(nullable であること)を明示的に宣言する必要があり、下記のように宣言します。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dart data-lang=Dart><span style=color:#66d9ef>int</span><span style=color:#f92672>?</span> number;
<span style=color:#66d9ef>int</span><span style=color:#f92672>?</span> number <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>; <span style=color:#75715e>// 上記と等価な宣言
</span></code></pre></div><p>Dart では nullable な変数を宣言するために、変数の型に ? をつけます。
そうすることで、宣言された変数に null を代入できるようになるため、変数の初期値を省略した場合には null が代入されるようになります。</p><p>null safety が有効でない場合にはすべての変数が nullable になりますので、初期値を省略した場合は変数の中身は null となります。</p><p>メソッドやその内部のスコープのみで使われるローカル変数については上記のルールはそのままあてはまりません。
ローカル変数はそのスコープ内のどこかで初期化されればよいため、たとえ null safety が有効であったとしても宣言と同時に初期化を行う必要はありません。</p><h3 id=遅延初期化>遅延初期化</h3><p>変数宣言時に初期値を決めることができない場合、ひとまず変数を null で初期化しておいて、時が来たら正しい値を代入するという方法があります。
アイディアとしては良いですが、この方法だとせっかくの null safety の性質を上手に活かせていません。
なぜなら、この変数における null は、変数がまだ初期化されていないという意味しか持っておらず、本質的に null を許容する必要はない(一度初期化された後は再び null になることはない)からです。
null safety が実現されている言語では、必要以上に変数を nullable にするのはランタイムの安全性に欠くので、できればそのような変数は non null な変数として定義できるとよいです。
そこで役に立つのが「遅延初期化」の仕組みです。</p><p>変数の遅延初期化を用いると、<strong>変数の宣言時の初期化を保留することができ、かつ変数を non null に保つ</strong>ことができます。
下記は変数<code>description</code>を遅延初期化によって宣言している例です。
変数の型の宣言の前に、<code>late</code>をつけることでその変数が遅延初期化されることを宣言することができます。
この変数はトップレベルの変数として定義されていますが、変数の宣言時には値を初期化せず、のちに実行される<code>main</code>関数内で値を代入することによって変数を初期化しています。
もちろん、遅延初期化を宣言している変数を初期化しないまま参照するとランタイムエラーが発生しますので、忘れずに適切なタイミングで変数を初期化する必要があります。
こうすることで、変数自体は non null を維持したま、初期化のタイミングを宣言時以外に遅延することができるようになります。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dart data-lang=Dart>late <span style=color:#66d9ef>String</span> description;

<span style=color:#66d9ef>void</span> main() {
  description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Feijoada!&#39;</span>;
  print(description);
}
</code></pre></div><p>遅延初期化は、上記で紹介した以外にもう一つ用途があります。
下記のように、変数を遅延初期化するのは先ほどと同じですが、初期化を関数によって行うよう指定されています。
この宣言では、変数<code>temperature</code>が初めて参照されたタイミングで、メソッド<code>readThermometer</code>が実行されて値が初期化されます。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dart data-lang=Dart>late <span style=color:#66d9ef>String</span> temperature <span style=color:#f92672>=</span> readThermometer(); <span style=color:#75715e>// Lazily initialized.
</span></code></pre></div><p>一見、あえて初期化を遅延させる意図がわからないかもしれませんが、変数<code>temperature</code>が必ずしも使われるとは限らない、かつ<code>readThermometer</code>が非常に時間のかかる処理である場合にはパフォーマンス面で有利に働く場合があります。</p><p>遅延せずに初期化をする場合、変数<code>temperature</code>が実際に利用されるかどうかにかかわらず宣言時に値が初期化されます。
実際に利用されることがなければ、この変数の初期化処理は必要ないため、せっかくの初期化処理が無駄になってしまいます。
<strong>必ずしも利用されるとは限らない変数については、初めての参照タイミングで初期化処理を実行する</strong>ようにすればこのような無駄は省くことができます。
この効果は、初期化が長時間処理であればあるほど大きくなります。</p><h3 id=final-定数と-const-定数>final 定数と const 定数</h3><p>コードの中で一度定義したらその値を二度と変更する必要がない場合があります。
その場合は、final もしくは const 修飾子によって変数を定数化することをお勧めします。
final もしくは const が付与された変数は、初期化時に与えられた値で固定され、その後の変更ができなくなります。
一見自由さを捨てているだけに思えますが、これは不用意な変更から変数を守る効果があります。
仮に間違って final や const 修飾されている値を変更しようとすると、コンパイルエラーが発生するため、誤った変更に起因するバグをあらかじめ防ぐことができます。
<strong>できる必要のないことはできないようにする</strong>ことが、バグの少ない安全なコードを書く上で大切です。</p><p>final と const の使い分けですが、コンパイル時に値を決定できる場合は const, ランタイムで値を初期化する必要がある場合は final を用いるとよいと思います。</p><p>例えば、光速や円周率などの値は宇宙のどこでも同じはずですので、初期化をランタイムで行う必要はありません。
このような値は、決して変わることのない定数としてコンパイル時に静的に確定することができますので、以下のように cosnt 修飾子によって定義するのが良いでしょう。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dart data-lang=Dart><span style=color:#66d9ef>const</span> c <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>; <span style=color:#75715e>// Speed of light.
</span></code></pre></div><p>一方で、final 修飾子の使いどころは下記のような場面でしょうか。
<code>getNumber</code>によって得られる値で変数を初期化しています。
以下の例では、cosnt によって値を初期化しようとするとエラーになります。
<code>getNumber</code>が定数を返しているので以下の例では問題ないように見えますが、<code>getNumber</code>によって値が初期化されるのはあくまで<code>getNumber</code>が実行されるタイミングです。
そのため、<code>cosntNumber</code>の値はコンパイル時に静的に決まっているわけではありません。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dart data-lang=Dart><span style=color:#66d9ef>void</span> main() {
  <span style=color:#66d9ef>final</span> finalNumber <span style=color:#f92672>=</span> getNumber();
  <span style=color:#66d9ef>const</span> constNumber <span style=color:#f92672>=</span> getNumber(); <span style=color:#75715e>// Error
</span><span style=color:#75715e></span>}

<span style=color:#66d9ef>int</span> getNumber() {
  <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}
</code></pre></div><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=https://mtakamur.github.io/dart/basis_on_function/ title=関数の基礎><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=https://mtakamur.github.io/dart/collection/ title=コレクション style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=https://mtakamur.github.io/js/clipboard.min.js?1660402441></script><script src=https://mtakamur.github.io/js/perfect-scrollbar.min.js?1660402441></script><script src=https://mtakamur.github.io/js/perfect-scrollbar.jquery.min.js?1660402441></script><script src=https://mtakamur.github.io/js/jquery.sticky.js?1660402441></script><script src=https://mtakamur.github.io/js/featherlight.min.js?1660402441></script><script src=https://mtakamur.github.io/js/highlight.pack.js?1660402441></script><script>hljs.initHighlightingOnLoad()</script><script src=https://mtakamur.github.io/js/modernizr.custom-3.6.0.js?1660402441></script><script src=https://mtakamur.github.io/js/learn.js?1660402441></script><script src=https://mtakamur.github.io/js/hugo-learn.js?1660402441></script><script src=https://unpkg.com/mermaid@8.8.0/dist/mermaid.min.js></script><script>mermaid.initialize({startOnLoad:!0})</script></body></html>